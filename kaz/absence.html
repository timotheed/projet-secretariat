<!DOCTYPE html>

<html lang="fr">
  <head>
    <meta charset="utf8">
    <title>Absence</title>
    <link rel="shot cut icon" href="subaru.ico">
    <link rel="stylesheet" href="absence.css">
  </head>

  <body>
    <header>
      <a href="acceuil.html" id="return"> return</a>
      <p id="header"><strong> Absence </strong></p>
    </header>

    <form style="background: white; text-align:center;">
      <button id="confirmer" type="submit" style="border-radius: 5px;">confirmer</button>
      <button type="reset" style="border-radius: 5px;">reset</button>
      <table style="width:100%">
        <tr>
          <th><br>
            <section id="nomprof">
            
              <input list="nomDuProf" id='nom' placeholder="NOM DU PROF" name="q" /><br>
      		<datalist id="nomDuProf">
     		</datalist>
          	  <br/>
      		
              <input type="text" size="3" maxlength="2" id="day" placeholder="day">
              <input type="text" size="3" maxlength="2" id="month" placeholder="month">
              <input type="text" size="4" maxlength="4" id="years" placeholder="years">
            </section><br>
            
            <button type="button" id="plus" style="border-radius: 5px;" >+</button>
            <section id="cours">
              <section id="hour1">
                <select id="premiercours1" name="hour" size="1">
                    <option value="h1" selected>h1</option>
                    <option value="h2">h2</option>
                    <option value="h3">h3</option>
                    <option value="h4">h4</option>
                    <option value="h5">h5</option>
                    <option value="h6">h6</option>
                    <option value="h7">h7</option>
                    <option value="h8">h8</option>
                    <option value="h9">h9</option>
                    <option value="h10">h10</option>
                    <option value="h11">h11</option>
                </select>
                <select id="deuxiemecours1"name="hour" size="1">
                    <option value="zero"> </option>
                    <option value="h1">h1</option>
                    <option value="h2" selected>h2</option>
                    <option value="h3">h3</option>
                    <option value="h4">h4</option>
                    <option value="h5">h5</option>
                    <option value="h6">h6</option>
                    <option value="h7">h7</option>
                    <option value="h8">h8</option>
                    <option value="h9">h9</option>
                    <option value="h10">h10</option>
                    <option value="h11">h11</option>
                  </select>
                  Nom de cours : <input list="nomDuCours" id='nomCours' placeholder="NOM DU COURS" name="p" /><br>
     		<datalist id="nomDuCours">
      		</datalist>
                  <br>
              </section>
            </section>
          </th>
          <th valign="top">
            <textarea name="moreinfo" placeholder="more information" cols="40" rows="5" id="moreinfo"></textarea>
          </th>
        </tr>
      </table>
    </form>
<p id='resultat'></p>
    <script>
      var i=2;
      document.getElementById("plus").addEventListener("click",function(){
        if(i<12){
          var a=document.getElementById("hour1");
          var clone=a.cloneNode(true);
          clone.id="hour"+i;
          clone.childNodes[1].id="premiercours"+i;
          clone.childNodes[1].nextElementSibling.id="deuxiemecours"+i;
          var b=document.getElementById("cours");
          b.appendChild(clone);
          i++;
        };
        return i;
      });
      for(n=1;n<i+1;n++){
        var leselements = document.getElementById("cours");
        leselements.addEventListener("change", function(e){
          var premih = e.target.selectedIndex;
          e.target.nextElementSibling.selectedIndex=premih+2;
        });
      };
      var xmlhttp = new XMLHttpRequest();
	var url = "donnees_profs.txt";
	var cetobj ={} ;
	var n =0;

xmlhttp.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var myArr = JSON.parse(this.responseText);
        myFunction(myArr);
        mFunction(myArr);
    };
};
xmlhttp.open("GET", url, true);
xmlhttp.send();

function myFunction(arr) {
	for (var i in arr.profs) {
	document.getElementById("nomDuProf").innerHTML += '<option value="'+arr.profs[i].name+'">';
	};	
};

function mFunction(arr) {
	
	document.getElementById("nom").addEventListener("blur",function(){
	n = 0 ;
	while(arr.profs[n].name != nom.value){
	n++;
	};
	document.getElementById("nomDuCours").innerHTML = "";
        for (var o in arr.profs[n].cours){
        document.getElementById("nomDuCours").innerHTML += '<option value="'+arr.profs[n].cours[o]+'">';
        };
        });
        document.getElementById("confirmer").addEventListener("click",function(){
        cetobj.prof = nom.value,
        cetobj.cours = nomCours.value;
        document.getElementById("resultat").innerHTML = cetobj.prof+" : "+cetobj.cours;
        });
};
      
      
      
      
    </script>
  </body>
</html>
